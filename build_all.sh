#!/bin/bash 
DOCKER_USER=${DOCKER_USER:-'emmaheff'}
PWD=`pwd`
LS=`ls`
IMAGE="$DOCKER_USER/`basename $PWD`"

for i in $LS; do
    echo "Checking: $i"
    if [[ -d $i ]]; then
        cd $i
        DOCKER_CMD="docker build -t $IMAGE ."
        echo "Running: $DOCKER_CMD"
        $DOCKER_CMD
        if [[ $1 == 'push' ]]; then
            PUSH_CMD="docker push $IMAGE"
            echo "Running: $PUSH_CMD"
            $PUSH_CMD
        fi
        cd ..
    fi
done
  
