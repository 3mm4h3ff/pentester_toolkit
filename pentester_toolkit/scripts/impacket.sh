#!/bin/bash
# Author: Emma Heffernan
# Description: Python Scripts can be ran using Impacket tool

# Initialising the toolexit variable to equal 0
TOOL_EXIT=0
# Running until the user wants to exit the tool
while [ $TOOL_EXIT == 0 ]; do 

    # Initialising the variables
    TARGET_PORT=""
    TARGET_IP=""
    IMPACKET_DOMAIN=""
    IMPACKET_PASS=""
    IMPACKET_USER=""
    REG_NAME=""
    IMPACKET_ACTION=""
    IMPACKET_SCRIPT=""

    # Creating titles and options list for user input
    echo ""
    echo "Impacket Basics"
    echo ""
    echo "Please select 1 of the following options: "
    echo ""
    echo "  1. smbclient.py"
    echo "  2. lookupsid.py"
    echo "  3. reg.py"
    echo "  4. DIY Scripts"
    echo "  0. Exit Impacket Basics"

    # Intaking the user input for above options
    read -e -p "Please enter an option: " USER_INPUT
    # Rely to the user what they entered
    echo "You entered: $USER_INPUT" 
    
    # Matching the options in the menu above, the user can input their option choice, first here being to exit the problem
    if [[ $USER_INPUT == 0 ]]; then
        TOOL_EXIT=1
    # User selecting option 1 can run an smbclinet python script by entering their IP, username, password and domain name
    elif [[ $USER_INPUT == 1 ]]; then
        read -e -p "Enter Target IP: " TARGET_IP
        read -e -p "Enter Username: " IMPACKET_USER
        read -e -p "Enter Password: " IMPACKET_PASS
        read -e -p "Enter Domain Name: " IMPACKET_DOMAIN
        IMPACKET_ACTION="cd examples"
        IMPACKET_SCRIPT="smbclient.py"
    # Selecting number 2 allows the user to run the looksidup python script with there IP, username, password and domain name
    elif [[ $USER_INPUT == 2 ]]; then
        read -e -p "Enter Target IP: " TARGET_IP
        read -e -p "Enter Username: " IMPACKET_USER
        read -e -p "Enter Password: " IMPACKET_PASS
        read -e -p "Enter Domain Name: " IMPACKET_DOMAIN
        IMPACKET_ACTION="cd examples"
        IMPACKET_SCRIPT="lookupsid.py"
    # Option 3 is running of the red python script with users IP, username, password, domain name and registry name
    elif [[ $USER_INPUT == 3 ]]; then
        read -e -p "Enter Target IP: " TARGET_IP
        read -e -p "Enter Username: " IMPACKET_USER
        read -e -p "Enter Password: " IMPACKET_PASS
        read -e -p "Enter Domain Name: " IMPACKET_DOMAIN
        read -e -p "Enter Registry Key Name: " REG_NAME
        IMPACKET_ACTION="cd examples"
        IMPACKET_SCRIPT="reg.py"
    # Option 4 allows the user to enter a bas terminal to freely run their own scripts and used the premaded ones
    elif [[ $USER_INPUT == 4 ]]; then
        echo "Run premade scripts or make your own. Enjoy!"
        IMPACKET_ACTION="ls"
        IMPACKET_SCRIPT="/home/scripts/bash.sh"
        echo ""
        echo "Enjoy the freedom of scripting your own scripts or using the Impacket premade ones below!"
        echo ""
        echo "NOTE: There are more scripts in '/examples'"
        echo "Current File Path: /impacket"
        echo ""
    else
        echo "Incorrect option, please try again!"
    fi
    # if user enters 0 if will exit however if the value is greater it will run the curl command with all variables attached
    if [[ TOOL_EXIT != 0 ]]; then
        cd /impacket && $IMPACKET_ACTION && $IMPACKET_SCRIPT $IMPACKET_DOMAIN/$IMPACKET_USER:$IMPACKET_PASS@$TARGET_IP $TARGET_PORT $REG_NAME
    fi
# End of the do while loop
done
