#!/bin/bash
# Author: Emma Heffernan
# Description: 

TOOL_EXIT=0
while [ $TOOL_EXIT == 0 ]; do 

    TARGET_PORT=""
    TARGET_IP=""
    IMPACKET_DOMAIN=""
    IMPACKET_PASS=""
    IMPACKET_USER=""
    REG_NAME=""
    IMPACKET_ACTION=""
    IMPACKET_SCRIPT=""

    echo "Impacket Basics"
    echo "Please select 1 of the following options: "
    echo "  1. smbclient.py"
    echo "  2. lookupsid.py"
    echo "  3. reg.py"
    echo "  4. DIY Scripts"
    echo ""
    echo "0. Exit Impacket Basics"

    read -p "Please enter an option: " USER_INPUT
    echo "You entered: $USER_INPUT" 
    
    if [[ $USER_INPUT == 0 ]]; then
        TOOL_EXIT=1
    elif [[ $USER_INPUT == 1 ]]; then
        read -p "Enter Target IP: " TARGET_IP
        read -p "Enter Username: " IMPACKET_USER
        read -p "Enter Password: " IMPACKET_PASS
        read -p "Enter Domain Name: " IMPACKET_DOMAIN
        IMPACKET_ACTION="cd examples"
        IMPACKET_SCRIPT="smbclient.py"
    elif [[ $USER_INPUT == 2 ]]; then
        read -p "Enter Target IP: " TARGET_IP
        read -p "Enter Username: " IMPACKET_USER
        read -p "Enter Password: " IMPACKET_PASS
        read -p "Enter Domain Name: " IMPACKET_DOMAIN
        IMPACKET_ACTION="cd examples"
        IMPACKET_SCRIPT="lookupsid.py"
    elif [[ $USER_INPUT == 3 ]]; then
        read -p "Enter Target IP: " TARGET_IP
        read -p "Enter Username: " IMPACKET_USER
        read -p "Enter Password: " IMPACKET_PASS
        read -p "Enter Domain Name: " IMPACKET_DOMAIN
        read -p "Enter Registry Key Name: " REG_NAME
        IMPACKET_ACTION="cd examples"
        IMPACKET_SCRIPT="reg.py"
    elif [[ $USER_INPUT == 4 ]]; then
        echo "Run premade scripts or make your own. Enjoy!"
        IMPACKET_ACTION="ls"
        IMPACKET_SCRIPT="/home/scripts/bash.sh"
        echo ""
        echo "Enjoy the freedom of scripting your own scripts or using the Impacket premade ones below!"
        echo ""
        echo "NOTE: There are more scripts in '/examples'"
        echo "Current File Path: /impacket"
        echo ""
    else
        echo "Incorrect option, please try again!"
    fi

    if [[ TOOL_EXIT != 0 ]]; then
        cd /impacket && $IMPACKET_ACTION && $IMPACKET_SCRIPT $IMPACKET_DOMAIN/$IMPACKET_USER:$IMPACKET_PASS@$TARGET_IP $TARGET_PORT $REG_NAME
    fi
done
